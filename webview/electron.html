<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy"
          content="default-src 'self'; style-src 'self' 'unsafe-inline'; script-src 'self';">
    <title>GCC Map View</title>
    <style>
        /* CSS variables â€” standalone theme (dark) */
        :root {
            --bg: #1e1e1e;
            --bg-sidebar: #252526;
            --bg-input: #3c3c3c;
            --bg-hover: rgba(255, 255, 255, 0.06);
            --fg: #cccccc;
            --fg-dim: #888888;
            --border-color: #3c3c3c;
            --accent: #4fc1ff;
            --focus-border: #007acc;

            /* Map vscode CSS vars used by memoryMap.css */
            --vscode-font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --vscode-font-size: 13px;
            --vscode-foreground: var(--fg);
            --vscode-editor-background: var(--bg);
            --vscode-descriptionForeground: var(--fg-dim);
            --vscode-panel-border: var(--border-color);
            --vscode-focusBorder: var(--focus-border);
            --vscode-progressBar-background: #333;
            --vscode-editorHoverWidget-background: #252526;
            --vscode-editorHoverWidget-border: #454545;
            --vscode-editorHoverWidget-foreground: #ccc;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: var(--vscode-font-family);
            font-size: var(--vscode-font-size);
            color: var(--fg);
            background: var(--bg);
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        #top-panel {
            display: flex;
            flex: 1;
            min-height: 0;
            overflow: hidden;
        }

        #source-panel {
            height: 250px;
            min-height: 80px;
            border-top: 1px solid var(--border-color);
            display: none;
            flex-direction: column;
        }

        #source-panel.visible {
            display: flex;
        }

        #source-header {
            display: flex;
            align-items: center;
            padding: 4px 12px;
            background: var(--bg-sidebar);
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        #source-header .source-title {
            font-weight: 600;
            color: var(--fg);
            font-size: 12px;
        }

        #source-content-wrapper {
            flex: 1;
            overflow: auto;
            background: var(--bg);
        }

        #source-content {
            margin: 0;
            padding: 4px 0;
            font-family: 'Consolas', 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.4;
            color: var(--fg);
            tab-size: 4;
        }

        #source-content .source-line {
            display: flex;
            white-space: pre;
            padding: 0 12px 0 0;
        }

        #source-content .source-line:hover {
            background: var(--bg-hover);
        }

        #source-content .source-line.highlighted {
            background: rgba(0, 122, 204, 0.25);
        }

        #source-content .line-number {
            display: inline-block;
            width: 5em;
            text-align: right;
            padding-right: 1em;
            color: var(--fg-dim);
            user-select: none;
            flex-shrink: 0;
        }

        #source-content .line-text {
            flex: 1;
        }

        #source-resize-handle {
            height: 4px;
            cursor: ns-resize;
            background: transparent;
            flex-shrink: 0;
        }

        #source-resize-handle:hover {
            background: var(--focus-border);
        }

        #map-panel {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        /* Drag-and-drop overlay */
        #drop-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 122, 204, 0.15);
            border: 3px dashed var(--accent);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: var(--accent);
            pointer-events: none;
        }

        #drop-overlay.visible {
            display: flex;
        }
    </style>
    <link rel="stylesheet" href="tree.css">
    <link rel="stylesheet" href="memoryMap.css">
</head>
<body>
    <!-- Top panel: tree + map side by side -->
    <div id="top-panel">
        <!-- Tree sidebar -->
        <div id="tree-panel">
            <div id="tree-search-container">
                <input type="text" id="tree-search" placeholder="Search symbols...">
            </div>
            <div id="tree"></div>
        </div>

        <!-- Memory map -->
        <div id="map-panel">
            <div id="app">
                <div class="no-data">Drop a .map or .ld file here, or use File &gt; Open.</div>
            </div>
            <div id="tooltip" class="tooltip"></div>
        </div>
    </div>

    <!-- Source text panel -->
    <div id="source-panel">
        <div id="source-resize-handle"></div>
        <div id="source-header">
            <span class="source-title" id="source-filename">Source</span>
        </div>
        <div id="source-content-wrapper">
            <pre id="source-content"></pre>
        </div>
    </div>

    <!-- Drag-and-drop overlay -->
    <div id="drop-overlay">Drop file to open</div>

    <!-- IPC adapter (must load before other scripts) -->
    <script src="ipc-electron.js"></script>

    <!-- Cross-component highlight bridges -->
    <script src="highlight-bridge.js"></script>

    <!-- Tree and memory map scripts -->
    <script src="tree.js"></script>
    <script src="memoryMap.js"></script>

    <!-- Source panel logic -->
    <script src="source-panel.js"></script>

    <!-- Drag-and-drop handler -->
    <script src="drop-handler.js"></script>
</body>
</html>
